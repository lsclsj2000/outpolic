<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{user/layout/userLayoutkjw}">
<head>
    <meta charset="UTF-8">
    <title>포트폴리오 문의하기</title>
    </head>
<body>
<th:block layout:fragment="contents">
    <div class="inquiry-container">
        <h1 class="section-title">포트폴리오 문의</h1>
        <div class="card">
            <div class="info-box" th:if="${portfolio != null}">
                <h3>문의 대상 포트폴리오</h3>
                <p th:text="${portfolio.prtfTtl}">[포트폴리오 제목]</p>
            </div>

            <form id="portfolio-inquiry-form">
                <input type="hidden" name="ent_cd" th:value="${portfolio.entCd}">
                <input type="hidden" name="cl_cd"  th:value="${portfolio.clCd}">
                <input type="hidden" name="ocd_req_type" value="문의">

                <div class="form-group">
                    <label for="title">문의 제목<span class="required">*</span></label>
                    <input type="text" id="title" name="ocd_ttl" class="form-control" th:value="${portfolio != null ? portfolio.prtfTtl + ' 포트폴리오 관련 문의' : ''}" required>
                </div>
                <div class="form-group">
                    <label for="amount">희망 예산 (원)</label>
                    <input type="number" id="amount" name="ocd_amt" class="form-control" placeholder="숫자만 입력 (협의 가능 시 비워두세요)">
                </div>
                <div class="form-group">
                    <label for="explanation">상세 문의 내용<span class="required">*</span></label>
                    <textarea id="explanation" name="ocd_expln" class="form-control" rows="8" placeholder="궁금한 점이나 협업하고 싶은 내용에 대해 자유롭게 작성해주세요." required style="min-height: 200px;"></textarea>
                </div>
                
                <input type="hidden" name="ocd_frctn_cmdty" value="협의">
                <input type="hidden" name="ocd_dlvgds_mthd" value="협의">
                <input type="hidden" name="ocd_strt_ymdt" value="1970-01-01 00:00:00">
                <input type="hidden" name="ocd_dedline" value="1970-01-01 00:00:00">

                <button type="submit" id="submit-button" class="btn-submit">문의하기</button>
            </form>
        </div>
    </div>
</th:block>

<th:block layout:fragment="jsFile">
    <script>
        document.getElementById('portfolio-inquiry-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const form = e.target;
            const submitButton = document.getElementById('submit-button');
            const clCdInput = form.querySelector('input[name="cl_cd"]');

            if (!clCdInput || !clCdInput.value) {
                alert('콘텐츠 정보가 없어 문의를 등록할 수 없습니다. 포트폴리오 데이터를 확인해주세요.');
                return;
            }

            submitButton.disabled = true;
            submitButton.textContent = '전송 중...';

            fetch('/user/outsourcing-requests', {
                method: 'POST',
                body: new FormData(form)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    window.location.href = data.redirectUrl;
                } else {
                    throw new Error(data.message || '알 수 없는 오류');
                }
            })
            .catch(error => {
                console.error("Fetch error:", error);
                alert(`오류: ${error.message}`);
                submitButton.disabled = false;
                submitButton.textContent = '문의하기';
            });
        });
    </script>
</th:block>
</body>
</html>