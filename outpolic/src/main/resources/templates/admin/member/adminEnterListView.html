<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{admin/layout/adminLayoutMain}">

<head>
	<meta name="description" content="í•œêµ­ìŠ¤ë§ˆíŠ¸ì •ë³´êµìœ¡ì› íŒ€í”„ë¡œì íŠ¸" />
	<style>
		.pagination .page-item .page-link {
			min-width: 40px; /* ë„ˆë¹„ í™•ë³´ */
			height: 40px;
			padding: 6px 10px; /* ë‚´ë¶€ ì—¬ë°± */
			text-align: center; /* í…ìŠ¤íŠ¸ ê°€ìš´ë° ì •ë ¬ */
			line-height: 1.5; /* ì¤„ê°„ê²© ì¡°ì • */
			display: inline-flex; /* ì •ë ¬ ê°œì„  */
			justify-content: center;
			align-items: center;
			font-size: 14px; /* í•„ìš” ì‹œ í°íŠ¸ ì‚¬ì´ì¦ˆ ì¡°ì • */
		}
	</style>
</head>

<body>
	<th:block layout:fragment="contents">
		<section class="content-main">
			<div class="content-header">
				<h2 class="content-title card-title">ê¸°ì—… ëª©ë¡</h2>
			</div>
			<div class="card mb-4">
				<header class="card-header">
					<div class="card mb-4 search-filter-card" style="border: none;">
						<div class="card-body search-filter-body">
							<div class="table-responsive">
								<table class="search-filter-table">
									<tbody>
										<!-- ğŸ” ê²€ìƒ‰ë°” ë¼ì¸ -->
										<tr>
											<th>ê²€ìƒ‰</th>
											<td>
												<div class="d-flex align-items-center gap-2">
													<input type="text" id="searchInput" class="form-control"
														placeholder="ê¸°ì—…ëª…, ëŒ€í‘œìëª…, ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸, íšŒì›ì½”ë“œ ê²€ìƒ‰"
														style="width: 300px;" />
													<button type="button" class="btn btn-primary btn-sm"
														id="searchBtn">ê²€ìƒ‰</button>
												</div>
											</td>
										</tr>

										<!-- ğŸ”½ ë“œë¡­ë‹¤ìš´ 2ê°œ ë¼ì¸ -->
										<tr>
											<th>í•„í„°</th>
											<td>
												<div class="d-flex align-items-center gap-3">
													<!-- ìƒíƒœ í•„í„° -->
													<select id="filterStatus" class="form-select form-select-sm"
														style="width: 180px;">
														<option value="">ì „ì²´ ìƒíƒœ</option>
														<option value="SD_ACTIVE">í™œì„± ê¸°ì—…</option>
														<option value="SD_WITHDRAWN">íƒˆí‡´ ê¸°ì—…</option>
														<option value="SD_DORMANT">íœ´ë©´ ê¸°ì—…</option>
														<option value="SD_LIMIT">ì œì¬ ê¸°ì—…</option>
													</select>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</header>
			</div>
			<div class="card mb-4">
				<!-- card-header end// -->
				<div class="card-body">
					<div class=" d-flex flex-row">
						<div class="d-flex flex-wrap gap-3 align-items-center mb-3 w-50">
							<p class="fs-6 mb-0">
								<span class="badge bg-light text-dark px-3 py-2"> ì „ì²´ ê¸°ì—… ìˆ˜
									: <span id="totalCount" class="fw-bold text-primary"
										th:text="${totalCount}">0</span> 
								</span>
							</p>

							<p class="fs-6 mb-0" id="filteredCountWrap" style="display: none;">
								<span class="badge bg-light text-dark px-3 py-2"> ê²€ìƒ‰ ê²°ê³¼ :
									<span id="filteredCount" class="fw-bold text-success">0</span> ê±´
								</span>
							</p>
						</div>
						<div class="w-50 mb-3" style="display : flex; justify-content : flex-end;">
							<select id="filterOrder" class="form-select w-auto d-inline-block ms-2">
								<option value="">ì •ë ¬ ê¸°ì¤€</option>
								<option value="recent">ìµœê·¼ ê°€ì…ìˆœ</option>
								<option value="oldest">ì˜¤ë˜ëœ ê°€ì…ìˆœ</option>
							</select>
						</div>
					</div>
					<div class="table-responsive">
						<table class="table table-hover table-fixed-layout">
							<colgroup>
								<col style="width: 3%;">
								<col style="width: 7%;">
								<col style="width: 15%;">
								<col style="width: 8%;">
								<col style="width: 15%;">
								<col style="width: 12%;">
								<col style="width: 18%;">
								<col style="width: 8%;">
								<col style="width: 14%;">
							</colgroup>
							<thead>
								<tr class="text-center">
									<th scope="col" class="start text-center col-1">no.</th>
									<th scope="col">ê¸°ì—… ì½”ë“œ</th>
									<th scope="col">ê¸°ì—…ëª…</th>
									<th scope="col">ëŒ€í‘œìëª…</th>
									<th scope="col">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</th>
									<th scope="col">ì—°ë½ì²˜</th>
									<th scope="col">ì£¼ì†Œ</th>
									<th scope="col">ìƒíƒœ</th>
									<th scope="col">ìƒì„¸ì •ë³´</th>
								</tr>
							</thead>
							<tbody id="enterTableBody" class="text-center">
								<tr th:if="${not #lists.isEmpty(enterList)}" th:each="corp, stat : ${enterList}">
									<td class="start text-center" th:text="${startRow + stat.index + 1}"></td>
									<td th:text="${corp.corpCode}">ê¸°ì—… ì½”ë“œ</td>
									<td th:text="${corp.corpName}">ê¸°ì—…ëª…</td>
									<td th:text="${corp.corpRprsv}">ëŒ€í‘œìëª…</td>
									<td th:text="${corp.corpBrno}">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</td>
									<td th:text="${corp.corpTelNo}">ì—°ë½ì²˜</td>
									<td th:text="${corp.corpAddress} + ' ' + ${corp.corpDAddress}">ì£¼ì†Œ</td>
									<td th:switch="${corp.statusCode}"><span th:case="SD_ACTIVE"
											class="badge rounded-pill alert-success">í™œì„±</span>
										<span th:case="SD_DORMANT" class="badge rounded-pill alert-info">íœ´ë©´</span> <span
											th:case="SD_WITHDRAWN" class="badge rounded-pill alert-info">íƒˆí‡´</span>
										<span th:case="SD_LIMIT" class="badge rounded-pill alert-warning">ì œì¬</span>
									</td>
									<td>
										<button class="btn btn-primary w-55 fw-bold btn-detail"
											th:data-code="${corp.memberCode}" data-bs-toggle="modal"
											data-bs-target="#enterDetailModal" style="padding: 5px 20px;">ìƒì„¸ì •ë³´</button>
									</td>
								</tr>
							</tbody>
						</table>
							<div id="paginationArea">
								<div
									th:insert="~{admin/fragments/pagination :: paginationFragment}"></div>
							</div>
					</div>
					<!-- table-responsive //end -->
				</div>
				<!-- card-body end// -->
			</div>
		</section>

		<div class="modal fade p-10" id="enterDetailModal" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h3>ê¸°ì—… ìƒì„¸ ì •ë³´</h3>
						<button type="button" class="btn btnEditMember btn-primary w-70 fw-bold">ì •ë³´
							ìˆ˜ì •í•˜ê¸°</button>
					</div>
					<div class="modal-body">
						<form class="admin memberEdit" th:action="@{/admin/enterList/detail}" method="post">
							<div class="row g-3">
								<div class="col-md-6">
									<label for="memberCode">íšŒì› ì½”ë“œ</label> <input type="text" id="memberCode"
										name="memberCode" class="form-control" disabled />
								</div>
								<div class="col-md-6">
									<label for="corpName">ê¸°ì—…ëª…</label> <input type="text" id="corpName" name="corpName"
										class="form-control readonly-field" readonly />
								</div>
								<div class="col-md-6">
									<label for="corpRprsv">ëŒ€í‘œìëª…</label> <input type="text" id="corpRprsv"
										name="corpRprsv" class="form-control readonly-field" readonly />
								</div>
								<div class="col-md-6">
									<label for="corpBrno">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label> <input type="text" id="corpBrno"
										name="corpBrno" class="form-control readonly-field" disabled />
								</div>
								<div class="col-md-6">
									<label for="corpTelNo">ì—°ë½ì²˜</label> <input type="text" id="corpTelNo"
										name="corpTelNo" class="form-control" disabled />
								</div>
								<div class="col-md-6">
									<label for="corpFndnYmdt">ì„¤ë¦½ì¼</label> <input type="text" id="corpFndnYmdt"
										name="corpFndnYmdt" class="form-control" disabled />
								</div>
								<div class="col-md-6">
									<label for="corpZip">ìš°í¸ë²ˆí˜¸</label> <input type="text" id="corpZip" name="corpZip"
										class="form-control readonly-field" disabled />
								</div>
								<div class="col-md-6">
									<label for="corpAddress">ì£¼ì†Œ</label> <input type="text" id="corpAddress"
										name="corpAddress" class="form-control readonly-field" disabled />
								</div>
								<div class="col-md-6">
									<label for="corpDAddress">ìƒì„¸ì£¼ì†Œ</label> <input type="text" id="corpDAddress"
										name="corpDAddress" class="form-control readonly-field" disabled />
								</div>
								<div class="col-md-6">
									<label for="corpScale">ê¸°ì—… ê·œëª¨</label> <input type="text" id="corpScale"
										name="corpScale" class="form-control readonly-field" readonly />
								</div>
								<div class="col-md-6">
									<label for="corpUrl">í™ˆí˜ì´ì§€</label> <input type="text" id="corpUrl" name="corpUrl"
										class="form-control readonly-field" readonly />
								</div>
								<div class="col-md-6">
									<label for="corpScr">í‰ì  (0~5.0)</label> <input type="text" id="corpScr"
										name="corpScr" class="form-control readonly-field" readonly />
								</div>

								<div class="col-md-6">
									<label for="corpJoinYmdt">ê°€ì…ì¼</label> <input type="text" id="corpJoinYmdt"
										name="corpJoinYmdt" class="form-control readonly-field" disabled />
								</div>
								<div class="col-md-6">
									<label for="corpStatusCode">ìƒíƒœ</label> <select id="corpStatusCode"
										name="corpStatusCode" class="form-select readonly-field" disabled>
										<option value="SD_ACTIVE">í™œì„±</option>
										<option value="SD_DORMANT">íœ´ë©´</option>
										<option value="SD_WITHDRAWN">íƒˆí‡´</option>
										<option value="SD_LIMIT">ì œì¬</option>
									</select>
								</div>
								<input type="hidden" id="adminCode" th:value="${adminCode}" />
							</div>
							<div class="text-center mt-4">
								<button type="button" id="btnSave" class="btn btnSave btn-primary w-70 fw-bold"
									disabled>ì •ë³´
									ìˆ˜ì •</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</th:block>
	<th:block layout:fragment="jsScript">
		<script>
			console.log("ìŠ¤í¬ë¦½íŠ¸ ë¡œë”©ë¨");

			$(document).ready(function () {

				// ğŸ” í•„í„°
				$('#filterStatus, #filterOrder').change(function () {
					const status = $('#filterStatus').val();
					const order = $('#filterOrder').val();

					$.ajax({
						url: '/admin/enterList/filter',
						type: 'GET',
						data: {
							statusCode: status,
							orderBy: order
						},
						dataType: 'json',
						success: renderEnterList,
						error: () => alert("í•„í„°ë§ ì‹¤íŒ¨")
					});
				});

				// ğŸ” ê²€ìƒ‰
				$('#searchBtn').click(function () {
					const keyword = $('#searchInput').val().trim();

					$('#filterStatus').val('');
					$('#filterOrder').val('');
					$.ajax({
						url: '/admin/enterList/search',
						type: 'GET',
						data: {keyword: keyword},
						success: renderEnterList,
						error: () => alert("ê²€ìƒ‰ ì‹¤íŒ¨")
					});
				});
				$('#searchInput').on('input', function () {
					const keyword = $(this).val().trim();
					if (keyword === '') {
						$('#filteredCountWrap').hide(); // ğŸ‘‰ 'ê²€ìƒ‰ ê²°ê³¼ Nëª…' ì˜ì—­ ìˆ¨ê¸°ê¸°
					}
				});

				// ğŸ“‹ íšŒì› ëª©ë¡ ë Œë”ë§ í•¨ìˆ˜
				function renderEnterList(data) {
					const tbody = $('#enterTableBody');
					 $('#paginationArea').hide();
					tbody.empty();
					// ê²°ê³¼ ê°œìˆ˜ ì¶œë ¥
					$('#filteredCount').text(data.length);
					$('#filteredCountWrap').show();

					if (!data || data.length === 0) {
						tbody.append('<tr><td colspan="9" class="text-center">ì¡°íšŒëœ ê¸°ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>');
						return;
					}

					data.forEach((corp, index) => {
						const statusLabel = corp.statusCode === 'SD_ACTIVE'
							? '<span class="badge rounded-pill alert-success">í™œì„±</span>'
							: corp.statusCode === 'SD_DORMANT'
								? '<span class="badge rounded-pill alert-info">íœ´ë©´</span>'
								: corp.statusCode === 'SD_WITHDRAWN'
									? '<span class="badge rounded-pill alert-info">íƒˆí‡´</span>'
									: '<span class="badge rounded-pill alert-warning">ì œì¬</span>';

						const row = `
                <tr class="text-center">
                	<td>${index + 1}</td>
                    <td>${corp.corpCode}</td>
                    <td>${corp.corpName}</td>
                    <td>${corp.corpRprsv}</td>
                    <td>${corp.corpBrno}</td>
                    <td>${corp.corpTelNo}</td>
                    <td>${corp.corpAddress} ${corp.corpDAddress}</td>
                    <td>${statusLabel}</td>
                    <td>
                        <button class="btn btn-primary w-55 fw-bold btn-detail"
                                data-code="${corp.memberCode}"
                                data-bs-toggle="modal"
                                data-bs-target="#enterDetailModal"
                                style="padding: 5px 20px;">ìƒì„¸ì •ë³´</button>
                    </td>
                </tr>
            `;
						tbody.append(row);
					});
				}

				console.log("ğŸš¨ document.ready ì‹¤í–‰ë¨");

				// ğŸ“„ ìƒì„¸ì •ë³´ ë³´ê¸° ë²„íŠ¼ í´ë¦­
				$(document).on('click', '.btn-detail', function () {
					const memberCode = $(this).data('code');

					$.ajax({
						url: '/admin/enterList/detail',
						type: 'GET',
						data: {memberCode},
						success: function (data) {
							$('#memberCode').val(data.memberCode);
							$('#corpName').val(data.corpName);
							$('#corpRprsv').val(data.corpRprsv);
							$('#corpBrno').val(data.corpBrno);
							$('#corpTelNo').val(data.corpTelNo);
							$('#corpFndnYmdt').val(data.corpFoundationYmdt);
							$('#corpZip').val(data.corpZip);
							$('#corpAddress').val(data.corpAddress);
							$('#corpDAddress').val(data.corpDAddress);
							$('#corpScale').val(data.corpScale);
							$('#corpUrl').val(data.corpUrl);
							$('#corpScr').val(data.corpScr);
							$('#corpJoinYmdt').val(data.corpJoinYmdt);
							$('#corpStatusCode').val(data.statusCode);
						},
						error: function () {
							alert('ê¸°ì—… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
						}
					});
				});

				// ğŸ“ ìˆ˜ì •ëª¨ë“œ í™œì„±í™”
				$('.btnEditMember').click(function () {
					$('.readonly-field').prop('readonly', false);
					$('#btnSave').prop('disabled', false);
				});

				// ğŸ’¾ ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ ìˆ˜ì • ìš”ì²­
				$(document).on('click', '#btnSave', function () {
					const corpData = {
						corpName: $('#corpName').val(),
						corpScale: $('#corpScale').val(),
						corpScr: $('#corpScr').val(),
						corpUrl: $('#corpUrl').val(),
						corpExplain: $('#corpExplain').val(),
						memberCode: $('#memberCode').val(),
						corpRprsv: $('#corpRprsv').val()
					};

					// í•„ìˆ˜ê°’ ìœ íš¨ì„± ê²€ì‚¬
					if (!corpData.corpName) {
						console.log("ğŸ“› corpName =", corpData.corpName);
						console.log("ğŸ“› adminCode =", corpData.adminCode);
						alert("ê¸°ì—…ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
						return;
					}
					if (corpData.corpScr > 5) {
						alert("í‰ì ì€ 5ì  ì´í•˜ì˜ ì ìˆ˜ë¥¼ ì†Œìˆ˜ì  í•œìë¦¬ê¹Œì§€ ì‘ì„±í•´ì£¼ì‹­ì‹œì˜¤.");
						return;
					}

					$.ajax({
						url: '/admin/enterList/detail/update',
						method: 'POST',
						contentType: 'application/json',
						data: JSON.stringify(corpData),
						success: function (result) {
							if (result === 'success') {
								alert('ê¸°ì—… ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
								location.reload();
							} else {
								alert('ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
							}
						},
						error: function () {
							alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
						}
					});
				});

				// ğŸ§¼ ëª¨ë‹¬ ë‹«í ë•Œ í•„ë“œ ì›ë³µ
				$('#enterDetailModal').on('hidden.bs.modal', function () {
					$('.readonly-field').prop('readonly', true);
					$('#corpStatusCode').prop('disabled', true);
				});

			});

		</script>
	</th:block>
</body>

</html>