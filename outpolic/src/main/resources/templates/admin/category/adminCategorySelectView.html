<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{admin/layout/adminLayoutMain}">

	<head>
		<meta name="description" content="한국스마트정보교육원 팀프로젝트" />
		<style>
			.ms-5 {
			    margin-left: 3rem !important;
			    padding-right: 16px;
			}
		</style>
	</head>
	
	<body>
		<th:block layout:fragment="contents">
    <section class="content-main">
        <!-- 1. 페이지 헤더 (통일된 스타일 적용) -->
        <div class="content-header">
            <h2 class="content-title">카테고리 관리</h2>
            <div>
                <!-- 향후 전체 저장, 새로고침 등 추가 기능 버튼 위치 -->
            </div>
        </div>

        <!-- 2. 메인 콘텐츠를 card 컴포넌트로 감싸기 -->
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <p class="mb-0 text-muted">대분류를 클릭하면 하위 카테고리가 펼쳐집니다.</p>
                            <!-- 3. 핵심 기능 버튼: '대분류 추가' -->
                            <button id="add-large-category-btn" type="button" class="btn btn-primary">+ 대분류 추가</button>
                        </div>

                        <!-- 기존 아코디언 목록 (card-body 내부에 배치) -->
                        <div class="list-group" id="categoryAccordion">

                            <!-- ==================== 대분류 반복 ==================== -->
                            <th:block th:if="${!#lists.isEmpty(categoryList)}">
                                <div th:each="largeCat : ${categoryList}" class="list-group-item flex-column align-items-start">
                                    <div class="d-flex w-100 justify-content-between align-items-center">
                                        <a class="h5 mb-1 text-decoration-none text-dark" data-bs-toggle="collapse" th:href="|#collapse-${largeCat.ctgryId}|" role="button" aria-expanded="false" th:aria-controls="|collapse-${largeCat.ctgryId}|">
                                            <i class="bi bi-chevron-down me-2"></i>
                                            <span th:text="|${largeCat.ctgryNm} (${largeCat.ctgryId})|">대분류 카테고리명</span>
                                        </a>
                                        <div>
                                            <!-- 4. JS 연동을 위한 data-* 속성 추가 -->
                                            <button type="button" class="btn btn-sm btn-outline-success btn-add-child" th:data-parent-id="${largeCat.ctgryId}" th:data-parent-name="${largeCat.ctgryNm}">중분류 추가</button>
                                            <button type="button" class="btn btn-sm btn-outline-primary btn-edit" th:data-ctgry-id="${largeCat.ctgryId}" th:data-ctgry-name="${largeCat.ctgryNm}">수정</button>
                                            <button type="button" class="btn btn-sm btn-outline-danger btn-delete" th:data-ctgry-id="${largeCat.ctgryId}" th:data-ctgry-name="${largeCat.ctgryNm}">삭제</button>
                                        </div>
                                    </div>
                                    <div class="collapse" th:data-bs-parent="'#categoryAccordion'" th:id="|collapse-${largeCat.ctgryId}|">
                                        <!-- 중분류/소분류 (기존 구조와 동일) -->
                                        <div class="list-group mt-2" th:if="${!#lists.isEmpty(largeCat.children)}">
                                            <div th:each="mediumCat : ${largeCat.children}" class="list-group-item border-0">
                                                <div class="d-flex w-100 justify-content-between align-items-center ms-3">
                                                    <a class="mb-0 text-decoration-none text-secondary" data-bs-toggle="collapse" th:href="|#collapse-${mediumCat.ctgryId}|" role="button" aria-expanded="false" th:aria-controls="|collapse-${mediumCat.ctgryId}|">
                                                        <i class="bi bi-chevron-right me-2"></i>
                                                        <span th:text="|${mediumCat.ctgryNm} (${mediumCat.ctgryId})|">중분류 카테고리명</span>
                                                    </a>
                                                    <div>
                                                        <button type="button" class="btn btn-sm btn-outline-success btn-add-child" th:data-parent-id="${mediumCat.ctgryId}" th:data-parent-name="${mediumCat.ctgryNm}">소분류 추가</button>
                                                        <button type="button" class="btn btn-sm btn-outline-primary btn-edit" th:data-ctgry-id="${mediumCat.ctgryId}" th:data-ctgry-name="${mediumCat.ctgryNm}">수정</button>
                                                        <button type="button" class="btn btn-sm btn-outline-danger btn-delete" th:data-ctgry-id="${mediumCat.ctgryId}" th:data-ctgry-name="${mediumCat.ctgryNm}">삭제</button>
                                                    </div>
                                                </div>
                                                <div class="collapse" th:id="|collapse-${mediumCat.ctgryId}|">
                                                    <ul class="list-group mt-2" th:if="${!#lists.isEmpty(mediumCat.children)}">
                                                        <li th:each="smallCat : ${mediumCat.children}" class="list-group-item list-group-item-light border-0">
                                                            <div class="d-flex w-100 justify-content-between align-items-center ms-5">
                                                                <span th:text="|${smallCat.ctgryNm} (${smallCat.ctgryId})|">소분류 카테고리명</span>
                                                                <div class="ms-auto">
                                                                    <button type="button" class="btn btn-sm btn-outline-primary btn-edit" th:data-ctgry-id="${smallCat.ctgryId}" th:data-ctgry-name="${smallCat.ctgryNm}">수정</button>
        															<button type="button" class="btn btn-sm btn-outline-danger btn-delete" th:data-ctgry-id="${smallCat.ctgryId}" th:data-ctgry-name="${smallCat.ctgryNm}">삭제</button>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </th:block>
                            <div th:if="${#lists.isEmpty(categoryList)}" class="list-group-item">
                                <p class="text-center mb-0">등록된 카테고리가 없습니다.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</th:block>

<!-- '추가할 js file' 위치에 아래 스크립트 블록을 추가합니다. -->
<script layout:fragment="jsScript">
    // 향후 '추가', '수정', '삭제' 버튼에 대한 이벤트 리스너를 이곳에 작성합니다.
    document.addEventListener('DOMContentLoaded', function() {
        
        const categoryAccordion = document.getElementById('categoryAccordion');

        // 이벤트 위임을 사용하여 모든 버튼 클릭을 한 번에 처리
        categoryAccordion.addEventListener('click', function(e) {
            const targetButton = e.target.closest('button');
            if (!targetButton) return;

            // '하위 추가' 버튼 클릭 시
            if (targetButton.classList.contains('btn-add-child')) {
                const parentId = targetButton.dataset.parentId;
                const parentName = targetButton.dataset.parentName;
                console.log(`'${parentName}'(${parentId})의 하위 카테고리 추가 로직 실행`);
                // TODO: 추가 모달을 띄우거나, 추가 폼을 동적으로 생성
            }

            // '수정' 버튼 클릭 시
            if (targetButton.classList.contains('btn-edit')) {
                const ctgryId = targetButton.dataset.ctgryId;
                const ctgryName = targetButton.dataset.ctgryName;
                console.log(`'${ctgryName}'(${ctgryId}) 수정 로직 실행`);
                // TODO: 수정 모달을 띄우고, 현재 이름(ctgryName)을 input에 기본값으로 설정
            }

            // '삭제' 버튼 클릭 시
            if (targetButton.classList.contains('btn-delete')) {
                const ctgryId = targetButton.dataset.ctgryId;
                const ctgryName = targetButton.dataset.ctgryName;
                console.log(`'${ctgryName}'(${ctgryId}) 삭제 로직 실행`);
                // TODO: 삭제 확인 컨펌(confirm) 창을 띄운 후, API 호출
            }
        });

        // '대분류 추가' 버튼
        const addLargeCategoryBtn = document.getElementById('add-large-category-btn');
        addLargeCategoryBtn.addEventListener('click', function() {
            console.log('대분류 추가 로직 실행');
            // TODO: 대분류 추가 모달 또는 페이지로 이동
        });
    });
</script>
	</body>
	<!-- 추가할 js file -->
	
</html>