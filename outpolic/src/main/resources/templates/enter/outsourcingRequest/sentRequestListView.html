<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{enter/layout/enterLayoutkjw}"> <head>
    <meta charset="UTF-8">
    <title>보낸 외주 요청 목록</title>
    </head>
<body>
<th:block layout:fragment="contents">
    <div class="main-container w-100">
        <h1 class="section-title">보낸 외주 요청 목록</h1>

        <div class="card">
            <table class="table">
                <thead>
                    <tr>
                        <th>요청 제목</th>
                        <th>공급자</th>
                        <th>요청일시</th>
                        <th>상태</th>
                        <th>관리</th>
                    </tr>
                </thead>
                <tbody id="sent-request-list-body">
                    </tbody>
            </table>
        </div>
    </div>
</th:block>

<th:block layout:fragment="jsFile">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 페이지 로드 시 보낸 요청 목록을 AJAX로 가져옴
            fetch('/enter/requests/sent/list')
                .then(response => response.json())
                .then(data => {
                    const listBody = document.getElementById('sent-request-list-body');
                    listBody.innerHTML = ''; // 기존 내용 비우기

                    if (data.length === 0) {
                        listBody.innerHTML = '<tr><td colspan="5" class="text-center">보낸 요청이 없습니다.</td></tr>';
                        return;
                    }

                    data.forEach(request => {
                        // 날짜 포맷 변경 (YYYY-MM-DD HH:MM)
                        const formattedDate = new Date(request.ocdDmndYmdt).toLocaleString('sv-SE').slice(0, 16);

                        const row = `
                            <tr>
                                <td>${request.ocdTtl}</td>
                                <td>${request.supplierName}</td>
                                <td>${formattedDate}</td>
                                <td><span class="badge rounded-pill alert-info">${request.statusName}</span></td>
                                <td><a href="/enter/requests/detail/${request.ocdCd}" class="btn btn-xs">상세보기</a></td>
                            </tr>
                        `;
                        listBody.innerHTML += row;
                    });
                })
                .catch(error => console.error('Error fetching sent requests:', error));
        });
    </script>
</th:block>
</body>
</html>