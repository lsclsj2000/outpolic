<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{enter/layout/enterLayoutContentsParticular}">

	<head>
	    <!-- 1. 브라우저 탭에 표시될 페이지 제목 -->
	    <title th:text="|${detail.contentsTitle} - outpolic|">콘텐츠 상세 정보</title>
	    <meta name="description" content="한국스마트정보교육원 팀프로젝트" />
	</head>
	
	<!-- 2. 메인 콘텐츠 영역 -->
	<th:block layout:fragment="contents">
	
	    <!-- 페이지 상단 경로 표시 (Breadcrumb) -->
	    <div class="page-header breadcrumb-wrap">
		    <div class="container">
		        <div class="breadcrumb">
		            <a th:href="@{/}" rel="nofollow"><i class="fi-rs-home mr-5"></i>Home</a>
		            <span></span> <a th:href="@{/enter/enterSearch}">콘텐츠</a>
		            <span th:text="${detail.contentsType}">타입</span>
		            <span th:text="${detail.contentsTitle}">제목</span>
		        </div>
		    </div>
		</div>
		
		<!-- 메인 콘텐츠 영역 -->
		<div class="page-content mb-50">
		    <div class="container">
		        <!-- ================================================================= -->
		        <!-- ============== 여기서부터 크몽 스타일의 2단 구조가 시작됩니다 ============== -->
		        <!-- ================================================================= -->
		        <div class="row">
		
		            <!-- 왼쪽: 이미지, 상세설명, 리뷰 등 긴 스크롤이 필요한 콘텐츠 영역 (8칸) -->
		            <div class="col-lg-8">
					    <!-- 이 div에 data-contents-id 속성을 추가합니다. -->
					    <div class="product-detail-main" th:data-contents-id="${detail.contentsId}">
					        
					        <!-- 1. 콘텐츠 제목 (모바일 화면을 위해 여기에 한번 더 표시해줄 수 있습니다. 선택사항) -->
					        <h2 class="title-detail d-lg-none" th:text="${detail.contentsTitle}">콘텐츠 제목</h2>
					
					        <!-- 2. 이미지 갤러리 (JavaScript가 여기를 채울 것입니다) -->
					        <div class="detail-gallery mb-50">
					            <span class="zoom-icon"><i class="fi-rs-search"></i></span>
					            <div class="product-image-slider">
					                <!-- 비워둠 -->
					            </div>
					        </div>
		
		                    <!-- 3. 상세 설명 (기존 탭 구조에서 꺼내왔습니다) -->
		                    <div class="product-description" id="description-section">
		                        <h3 class="mb-20">상세 설명</h3>
		                        <hr class="my-4">
		                        <div th:utext="${detail.contentsBody}">
		                            <p>DB에서 가져온 상세 설명이 여기에 표시됩니다.</p>
		                            <!-- 여기에 아주 긴 내용이 들어갈 것입니다. -->
		                        </div>
		                    </div>
		
		                    <!-- 4. 리뷰 (기존 탭 구조에서 꺼내왔습니다) -->
		                    <div class="product-reviews mt-50" id="reviews-section">
		                        <h3 class="mb-20">리뷰 (0)</h3>
		                        <hr class="my-4">
		                        <!-- 리뷰 목록 표시 영역 -->
		                        <p>아직 리뷰가 없습니다.</p>
		                    </div>
		
		                </div>
		            </div>
		
		            <!-- 오른쪽: 가격, 구매 버튼 등 스크롤을 따라다니는 정보 영역 (4칸) -->
		            <div class="col-lg-4">
		                <!-- 이 div가 스크롤을 따라다닐 영역입니다. -->
		                <div class="product-sidebar-sticky border-radius-10 p-30">
		                    
		                    <!-- 기존에 이미지 오른쪽에 있던 정보들을 이곳으로 모두 옮깁니다. -->
		                    
		                    <!-- 콘텐츠 제목 -->
		                    <h2 class="title-detail d-none d-lg-block" th:text="${detail.contentsTitle}">콘텐츠 제목</h2>
		                    
		                    <!-- 작성자 정보 -->
		                    <div class="product-by mb-20">
		                        <span>By: <a th:href="@{/user/company/{id}(id=${detail.enterCode})}" th:text="${detail.enterName}">작성자 이름</a></span>
		                    </div>
		                    
		                    <hr class="my-4">
		
		                    <!-- 가격 정보 -->
		                    <div class="product-price mt-10">
		                        <span class="h3" th:if="${detail.price > 0}" th:text="|${#numbers.formatInteger(detail.price, 3, 'COMMA')} 원|">가격</span>
		                        <span class="h3" th:unless="${detail.price > 0}">가격 협의</span>
		                    </div>
		                    <br>
		                    
		                    <!-- 간단한 요약 설명 -->
		                    <div class="short-desc my-30" th:utext="${detail.contentsBody}">
		                        <p class="font-lg"></p>
		                    </div>
		                    <br>
		                    <!-- 구매 또는 문의 버튼 -->
		                    <div class="detail-extralink" th:if="${detail != null}">
		                        <!-- 버튼이 꽉 차도록 w-100 클래스 추가 -->
		                       <a th:href="@{/user/outsourcing-requests/form/{id}(id=${detail.contentsId})}" 
							       class="button button-add-to-cart w-100">
							       <i class="fi-rs-shopping-cart"></i>신청하기
							    </a>
		                    </div>
		                    
		                    <!-- 타입, ID 등 추가 정보 -->
		                    <div class="font-xs mt-30">
		                        <ul class="list-unstyled">
		                            <li class="mb-5">타입: <span class="text-brand" th:text="${detail.contentsType}"></span></li>
		                        </ul>
		                    </div>
		                </div>
		            </div>
		        </div>
		    </div>
		</div>
	</th:block>
	
	<th:block layout:fragment="jsScript">
		<script th:inline="javascript">
			/*<![CDATA[*/
			
			document.addEventListener('DOMContentLoaded', function() {
			
			    // 1. Thymeleaf를 통해 서버에서 직접 전달받은 'detail' 객체를 JavaScript 변수로 받습니다.
			    //    이 방법은 페이지가 처음 로드될 때 이미 모든 데이터가 있다는 전제 하에 사용합니다.
			    const detail = /*[[${detail}]]*/ null;
			
			    if (!detail || !detail.filesJson) {
			        console.error('상세 정보 또는 파일 정보가 없습니다.');
			        return;
			    }
			
			    // 2. 이미지를 삽입할 부모 요소를 찾습니다.
			    const imageSlider = document.querySelector('.product-image-slider');
			
			    // 3. 'filesJson' 문자열을 실제 JavaScript 객체 배열로 변환합니다.
			    //    바로 이 부분이 작성자님께서 말씀하신 'JSON으로 받은 객체를 풀어서'에 해당하는 핵심 코드입니다.
			    const files = JSON.parse(detail.filesJson);
			    
			    // 4. 파일 배열이 비어있지 않다면, 각 파일을 <img> 태그로 변환합니다.
			    let imagesHtml = '';
			    if (files && files.length > 0) {
			        imagesHtml = files.map(file => 
			            // 표준 HTML <img> 태그를 생성합니다.
			            `<img src="${file.filePath}" alt="${file.fileOrgnlNm}" class="img-fluid">`
			        ).join(''); // 생성된 모든 <img> 태그 문자열을 하나로 합칩니다.
			    } else {
			        imagesHtml = '<p>상세 이미지가 없습니다.</p>';
			    }
			
			    // 5. 생성된 HTML을 slider 내부에 삽입하여 화면을 업데이트합니다.
			    imageSlider.innerHTML = imagesHtml;
			
			});
			
			/*]]>*/
			</script>
	</th:block>
</html>