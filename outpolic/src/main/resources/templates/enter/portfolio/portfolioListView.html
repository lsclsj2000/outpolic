<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{enter/layout/enterLayoutkjw}">
<head>
    <title>내 포트폴리오</title>
    <link rel="stylesheet" th:href="@{/enter/assets/css/main.css}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<th:block layout:fragment="contents">
    <div class="page-container">
        <div class="flex justify-between items-center mb-10">
            <h1 class="section-title">내 포트폴리오</h1>
            <button id="addPortfolioBtn" class="btn-action"><i class="fas fa-plus"></i> 새 포트폴리오 등록하기</button>
        </div>
        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
        <div id="portfolioItemsGrid" class="portfolio-items-grid"></div>
        <div id="noPortfolioMessage" class="no-portfolio-container hidden">
             <p class="no-portfolio-text"><strong>아직 등록된 포트폴리오가 없습니다.</strong><br>첫 프로젝트를 등록하고 당신의 전문성을 보여주세요!</p>
             <button id="addPortfolioBottomBtn" class="btn-action mt-6 py-4 px-10 text-xl"><i class="fas fa-plus"></i> 포트폴리오 등록하기</button>
        </div>
    </div>
    <!--  dㅏ-->
</th:block>
<th:block layout:fragment="jsFile">
    <script th:src="@{/enter/assets/js/vendor/jquery-3.6.0.min.js}"></script>
    <script>
        $(document).ready(function() {
            function loadAndRenderPortfolioList() {
                $.ajax({
                    url: '/enter/portfolio/listData', cache: false,
                    success: function(portfolios) {
                        const grid = $('#portfolioItemsGrid').empty();
                        if (portfolios && portfolios.length > 0) {
                            $('#noPortfolioMessage').hide();
                            portfolios.forEach(p => {
                                const categoriesHtml = (p.categories || []).map(cat => `<span class="badge bg-primary me-1">${cat.ctgryNm}</span>`).join('');
                                const tagsHtml = (p.tagNames || []).map(name => `<span class="badge bg-secondary me-1">#${name}</span>`).join('');
                                grid.append(`<div class="portfolio-item-card" data-prtf-cd="${p.prtfCd}"><div class="portfolio-thumbnail-wrapper"><img src="${p.prtfThumbnailUrl || 'https://via.placeholder.com/300x200?text=No+Image'}" alt="썸네일"></div><div class="portfolio-content"><h3 class="portfolio-title">${p.prtfTtl}</h3><div class="portfolio-meta"><div>${categoriesHtml}</div><div class="mt-2">${tagsHtml}</div></div><div class="portfolio-actions"><button class="btn-edit">수정</button><button class="btn-delete">삭제</button></div></div></div>`);
                            });
                        } else {
                            $('#noPortfolioMessage').show();
                        }
                    }
                });
            }

            $('#portfolioItemsGrid').on('click', 'button', function() {
                const prtfCd = $(this).closest('.portfolio-item-card').data('prtf-cd');
                if ($(this).hasClass('btn-edit')) {
                    window.location.href = `/enter/portfolio/edit/${prtfCd}`;
                } else if ($(this).hasClass('btn-delete')) {
                    if (confirm('정말로 삭제하시겠습니까?')) {
                        $.ajax({
                            url: `/enter/portfolio/delete/${prtfCd}`, type: 'DELETE',
                            success: (res) => { if(res.success) { alert('삭제되었습니다.'); loadAndRenderPortfolioList(); } else { alert('삭제 실패: ' + res.message); } },
                            error: () => alert('삭제 중 오류 발생')
                        });
                    }
                }
            });

            $('#addPortfolioBtn, #addPortfolioBottomBtn').on('click', () => window.location.href = '/enter/portfolio/add');
            loadAndRenderPortfolioList();
        });
    </script>
</th:block>
</body>
</html>