<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{enter/layout/enterLayoutkjw}">
<head>
    <title>내 포트폴리오</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- 기본 스타일 --- */
        .page-container { padding: 20px; max-width: 1200px; margin: 0 auto; }
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .mb-10 { margin-bottom: 40px; }
        .section-title { font-size: 2em; margin-bottom: 0 !important; }
        .btn-action { background-color: #4CAF50; border: none; color: white; padding: 10px 20px; text-align: center; display: inline-flex; align-items: center; gap: 5px; font-size: 16px; cursor: pointer; border-radius: 5px; transition: background-color 0.2s ease; }
        .btn-action:hover { background-color: #45a049; }
        .hidden { display: none !important; }
        .portfolio-item-card-link { text-decoration: none; color: inherit; display: block; height: 100%; }
        .portfolio-items-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .portfolio-item-card { border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background-color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; flex-direction: column; height: 100%; }
        .portfolio-thumbnail-wrapper { width: 100%; height: 180px; overflow: hidden; background-color: #f0f0f0; }
        .portfolio-thumbnail { width: 100%; height: 100%; object-fit: cover; }
        .portfolio-thumbnail-placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background-color: #f0f0f0; color: #aaa; font-size: 1rem; font-weight: 500; }
        .portfolio-content { padding: 15px; display: flex; flex-direction: column; flex-grow: 1; }
        .portfolio-title { font-size: 1.2em; margin-top: 0; margin-bottom: 10px; color: #333; }
        .portfolio-actions { display: flex; gap: 10px; margin-top: auto; border-top: 1px solid #eee; padding-top: 15px; }
        .btn-edit, .btn-delete, .btn-share { padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 0.9em; border: none; color: white; }
        .btn-edit { background-color: #007bff; }
        .btn-delete { background-color: #dc3545; }
        .btn-share { background-color: #17a2b8; }
        .no-portfolio-container { text-align: center; padding: 50px 20px; }
        
        /* --- 공유 모달 스타일 --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; display: none; justify-content: center; align-items: center; }
        .modal-content { background: #fff; padding: 20px; border-radius: 5px; width: 90%; max-width: 500px; text-align: center; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { margin: 0; font-size: 1.5em; }
        .modal-close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; }
        .share-buttons { display: flex; justify-content: center; gap: 15px; margin-top: 15px; }
    </style>
</head>
<body>
<th:block layout:fragment="contents">
    <div class="page-container">
        <div id="portfolioItemsGrid" class="portfolio-items-grid"></div>
        <div id="noPortfolioMessage" class="no-portfolio-container hidden">...</div>
    </div>

    <div id="shareModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="shareModalTitle" class="modal-title">포트폴리오 공유</h3>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="share-buttons">
                    <button id="modalCopyUrlBtn" class="btn-action">URL 복사</button>
                    <button id="modalShareFacebookBtn" class="btn-action" style="background-color:#1877F2;">페이스북</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block layout:fragment="jsFile">
    <script th:src="@{/enter/assets/js/vendor/jquery-3.6.0.min.js}"></script>
    <script>
        $(document).ready(function() {
            const grid = $('#portfolioItemsGrid');
            const noPortfolioMessage = $('#noPortfolioMessage');
            const shareModal = $('#shareModal');
            let shareUrl = '';
            let shareTitle = '';

            function loadAndRenderPortfolioList() {
                $.ajax({
                    url: '/enter/portfolio/listData',
                    cache: false,
                    success: function(portfolios) {
                        grid.empty();
                        if (portfolios && portfolios.length > 0) {
                            noPortfolioMessage.hide(); grid.show();
                            portfolios.forEach(p => {
                                const thumbnailUrl = p.prtfThumbnailUrl ? `<img src="${p.prtfThumbnailUrl}" alt="썸네일" class="portfolio-thumbnail">` : `<div class="portfolio-thumbnail-placeholder">이미지 없음</div>`;
                                const cardContent = `
                                    <div class="portfolio-thumbnail-wrapper">${thumbnailUrl}</div>
                                    <div class="portfolio-content">
                                        <h3 class="portfolio-title">${p.prtfTtl}</h3>
                                        <div class="portfolio-actions">
                                            <button class="btn-edit">수정</button>
                                            <button class="btn-delete">삭제</button>
                                            <button class="btn-share">공유</button>
                                        </div>
                                    </div>`;
                                const card = $(`<div class="portfolio-item-card" data-prtf-cd="${p.prtfCd}" data-prtf-ttl="${p.prtfTtl}">${cardContent}</div>`);
                                grid.append(card);
                            });
                        } else {
                            noPortfolioMessage.show(); grid.hide();
                        }
                    }
                });
            }

            // 이벤트 위임: 수정/삭제/공유 버튼 통합 처리
            grid.on('click', 'button', function(e) {
                e.preventDefault();
                const card = $(this).closest('.portfolio-item-card');
                const prtfCd = card.data('prtf-cd');

                if ($(this).hasClass('btn-edit')) {
                    window.location.href = `/enter/portfolio/edit/${prtfCd}`;
                } else if ($(this).hasClass('btn-delete')) {
                    if (confirm('정말로 삭제하시겠습니까?')) {
                        // ... (삭제 AJAX 로직) ...
                    }
                } else if ($(this).hasClass('btn-share')) {
                    shareTitle = card.data('prtf-ttl');
                    shareUrl = `${window.location.origin}/enter/portfolio/detail/${prtfCd}`;
                    $('#shareModalTitle').text(`'${shareTitle}' 공유하기`);
                    shareModal.css('display', 'flex');
                }
            });
            
            // 모달 내부 버튼 기능
            $('#modalCopyUrlBtn').on('click', function() {
                navigator.clipboard.writeText(shareUrl).then(() => alert('주소가 복사되었습니다.'));
            });
            $('#modalShareFacebookBtn').on('click', function() {
                window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`, '_blank', 'width=600,height=400');
            });

            // 모달 닫기
            $('.modal-close-btn').on('click', () => shareModal.hide());
            shareModal.on('click', (e) => { if ($(e.target).is(shareModal)) shareModal.hide(); });

            // "새 포트폴리오 등록하기" 버튼
            $('#addPortfolioBtn, #addPortfolioBottomBtn').on('click', () => window.location.href = '/enter/portfolio/add');

            // 초기 목록 로드
            loadAndRenderPortfolioList();
        });
    </script>
</th:block>
</body>
</html>