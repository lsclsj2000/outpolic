<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{enter/layout/enterLayoutkjw}">
<head>
    <meta charset="UTF-8">
    <title>포트폴리오 문의하기</title>
    <style>
        body {
            background-color: #f9fafb; /* 전체 배경색 */
        }
        .inquiry-container {
            max-width: 800px;
            margin: 2rem auto; /* 위아래 여백 및 가운데 정렬 */
            padding: 2rem;
        }
        .page-title {
            font-size: 2.25rem; /* 36px */
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 2rem;
            text-align: center;
        }
        .form-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 2.5rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        /* [수정] 문의 대상 정보를 깔끔하게 표시하는 부분 */
        .info-display {
            border: 1px solid #e5e7eb;
            background-color: #f9fafb;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        .info-display p {
            margin: 0;
            font-size: 1rem;
            color: #4b5563;
        }
        .info-display strong {
            color: #111827;
            margin-right: 0.5rem;
        }
        
        .form-group {
            margin-bottom: 1.75rem;
        }
        .form-group label {
            display: block;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #374151;
        }
        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-control:focus {
            border-color: #4f46e5;
            outline: 0;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15);
        }
        /* [수정] 숫자 입력 필드의 스피너(증감버튼) 제거 */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }

        .btn-submit {
            width: 100%;
            background: linear-gradient(90deg, #4f46e5, #6366f1);
            color: white;
            padding: 0.9rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.2);
        }
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.3);
        }
        .btn-submit:disabled {
            background: #a5b4fc;
            cursor: not-allowed;
        }
        .feedback-message {
            margin-top: 1rem;
            text-align: center;
            font-weight: 600;
        }
    </style>
</head>
<body>
<th:block layout:fragment="contents">
    <div class="inquiry-container">
        <h1 class="page-title">포트폴리오 문의하기</h1>

        <div class="form-card">
            <div class="info-display">
                <p><strong>To:</strong> <span th:text="${supplierName}">[공급자 기업 이름]</span></p>
                <p><strong>About:</strong> <span th:text="${portfolio.prtfTtl}">[문의 대상 포트폴리오 제목]</span></p>
            </div>

            <form id="portfolioInquiryForm">
                <input type="hidden" name="prtfCd" th:value="${portfolio.prtfCd}">
                <input type="hidden" name="entCd" th:value="${supplierCd}">
                <input type="hidden" name="ocdTtl" th:value="|'${portfolio.prtfTtl}' 포트폴리오 관련 문의|">

                <div class="form-group">
                    <label for="ocdExpln">의뢰 상세 내용</label>
                    <textarea id="ocdExpln" name="ocdExpln" class="form-control" rows="8" required placeholder="원하시는 작업 스타일, 내용, 분량 등을 구체적으로 작성해주세요."></textarea>
                </div>

                <div class="form-group">
                    <label for="ocdAmt">희망 예산 (원)</label>
                    <input type="number" id="ocdAmt" name="ocdAmt" class="form-control" placeholder="숫자만 입력해주세요 (예: 500000)">
                </div>

                <button type="submit" id="submitButton" class="btn-submit">문의 전송</button>
                <div id="formFeedback" class="feedback-message"></div>
            </form>
        </div>
    </div>
</th:block>

<th:block layout:fragment="jsFile">
    <script>
        document.getElementById('portfolioInquiryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitButton = document.getElementById('submitButton');
            const formFeedback = document.getElementById('formFeedback');
            const formData = new FormData(this);

            // [수정] 전송 중 버튼 비활성화 및 로딩 표시
            submitButton.disabled = true;
            submitButton.textContent = '전송 중...';
            formFeedback.textContent = '';

            fetch('/enter/portfolio-inquiry/submit', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    // 서버에서 에러 응답 시, 응답 내용을 기반으로 에러를 생성
                    return response.json().then(err => Promise.reject(err));
                }
                return response.json();
            })
            .then(data => {
                // [수정] alert 대신 페이지 내에 메시지 표시
                formFeedback.style.color = 'green';
                formFeedback.textContent = data.message || '성공적으로 전송되었습니다.';
                
                // 2초 후 '보낸 요청 목록' 페이지로 이동
                setTimeout(() => {
                    window.location.href = '/enter/requests/sent';
                }, 2000);
            })
            .catch(error => {
                console.error('Error:', error);
                // [수정] alert 대신 페이지 내에 오류 메시지 표시
                formFeedback.style.color = 'red';
                formFeedback.textContent = '오류: ' + (error.message || '알 수 없는 오류가 발생했습니다.');
                
                // 실패 시 버튼 다시 활성화
                submitButton.disabled = false;
                submitButton.textContent = '문의 전송';
            });
        });
    </script>
</th:block>
</body>
</html>