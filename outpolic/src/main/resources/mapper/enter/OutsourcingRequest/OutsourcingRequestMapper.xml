<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="outpolic.enter.outsourcingRequest.mapper.OutsourcingRequestMapper">
	
	<insert id="insertRequest" parameterType="outpolic.enter.outsourcingRequest.domain.OutsourcingRequestDTO">
    INSERT INTO outsourcing_request (
        ocd_cd,
        mbr_cd,
        ent_cd,
        cl_cd,
        chr_cd,
        ocd_ttl,
        ocd_expln,
        ocd_frctn_cmdty,
        ocd_dlvgds_mthd,
        ocd_strt_ymdt,
        ocd_dedline,
        ocd_amt
    ) VALUES (
        #{ocd_cd},
        #{mbr_cd},
        #{ent_cd},
        #{cl_cd},
        #{chr_cd},
        #{ocd_ttl},
        #{ocd_expln},
        #{ocd_frctn_cmdty},
        #{ocd_dlvgds_mthd},
        #{ocd_strt_ymdt},
        #{ocd_dedline},
        #{ocd_amt}
    )
</insert>
    

    <update id="updateChatRoomId">
        UPDATE outsourcing_contract_details SET chr_cd = #{chr_cd} WHERE ocd_cd = #{ocd_cd}
    </update>

    <select id="findSentRequests" resultType="outpolic.enter.outsourcingRequest.domain.RequestViewDTO">
        SELECT ocd.ocd_cd, ocd.ocd_ttl, e.ent_nm AS supplierName, ocd.ocd_dmnd_ymdt, ocd.stc_cd
        FROM outsourcing_contract_details ocd JOIN enterprise e ON ocd.ent_cd = e.ent_cd
        WHERE ocd.mbr_cd = #{requesterId} AND ocd.ocd_req_type = '신청'
        ORDER BY ocd.ocd_dmnd_ymdt DESC
    </select>
    
    <select id="findRequestDetailById" resultType="outpolic.enter.outsourcingRequest.domain.RequestViewDTO">
        SELECT ocd.*, m.mbr_nm as demanderName, e.ent_nm as supplierName
        FROM outsourcing_contract_details ocd
        JOIN member m ON ocd.mbr_cd = m.mbr_cd
        JOIN enterprise e ON ocd.ent_cd = e.ent_cd
        WHERE ocd.ocd_cd = #{requestId}
    </select>
</mapper>